<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="../robodoc.css" type="text/css" />
<title>./../src/solidSolvers/paraFEM/fem_routines/parafemutils.f90</title>
<!-- Source: ./../src/solidSolvers/paraFEM/fem_routines/parafemutils.f90 -->
<!-- Generated with ROBODoc Version 4.99.38 (Jan 10 2018) -->
</head>
<body>
<div id="logo">
<a name="robo_top_of_doc">OpenFPCI API (Version 1.1)</a>
</div> <!-- logo -->
<div id="navigation">
<a class="menuitem" href="../toc_index.html#top">Table of Contents</a>
<a class="menuitem" href="../robo_sourcefiles.html#top">Sourcefiles</a>
<a class="menuitem" href="../masterindex.html#top">Index</a>
<a class="menuitem" href="../robo_classes.html#top">Classes</a>
<a class="menuitem" href="../robo_functions.html#top">Functions</a>
<a class="menuitem" href="../robo_modules.html#top">Modules</a>
</div> <!-- navigation -->
<div id="content">
<hr />
<a name="parafeml2ffinddiagprecon"></a>
<a name="robo1"></a><h2>parafeml/finddiagprecon [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="./parafeml_f90.html#robo0">parafeml</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>finddiagprecon</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: <strong>finddiagprecon</strong>(store_km_pp_OF_,store_mm_pp_OF_,      &amp;
                            numSchemes_,diag_precon_pp_OF_); 
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Calculates the diagonal preconditioner vector used 
    in the PCG solution.
</pre>
<p class="item_name">INPUTS</p>
<pre>    store_km_pp (ntot,ntot,nels_pp)  - Stiffness Matrix
    store_mm_pp (ntot,ntot,nels_pp)  - Mass Matrix

    numVar      (a1 b1 theta dTim)   - Numerical Variables
    time_step                        - time step
    sProp       (e,v,rho)            - Rheology Properties
</pre>
<p class="item_name">OUTPUT</p>
<pre>    diag_precon_pp (neq_pp)          - Diagonal Preconditioner
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemnl2fwrite5flargestrain"></a>
<a name="robo6"></a><h2>parafemnl/write_largestrain [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>write_largestrain</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage:      CALL <strong>write_largestrain</strong>(timest)
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Master processor writes out brief details about the problem and 
    some performance data
</pre>
<p class="item_name">INPUTS</p>
<pre>    The following dynamic real array has the INTENT(IN) attribute:

    timest(:)              : Holds timing information
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Sam Hewitt
</pre>
<p class="item_name">CREATION DATE</p>
<pre>    21.03.2018
</pre>

<hr />
<a name="parafemnl2fwrite5fsmallstrain"></a>
<a name="robo7"></a><h2>parafemnl/write_smallstrain [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>write_smallstrain</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage:      CALL <strong>write_smallstrain</strong>(timest)
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Master processor writes out brief details about the problem and 
    some performance data
</pre>
<p class="item_name">INPUTS</p>
<pre>    The following dynamic real array has the INTENT(IN) attribute:

    timest(:)              : Holds timing information
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Sam Hewitt
</pre>
<p class="item_name">CREATION DATE</p>
<pre>    21.03.2018
</pre>

<hr />
<a name="parafemutils2fcalcnelsppof"></a>
<a name="robo8"></a><h2>parafemutils/calcnelsppof [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>calcnelsppof</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Unused in current version
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function is used to calculate the number 
    of elements per processor, it is a very primitive 
    form of mesh decomposition assigning elements to
    processors in order
</pre>
<p class="item_name">WARNINGS</p>
<pre>    This is a deprecated routine
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fcheckforce"></a>
<a name="robo9"></a><h2>parafemutils/checkforce [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>checkforce</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: checkforce_(force,sense,node_ensi,&amp;solidPatchIDSize,&amp;
                               paraFemSolidDisp,&amp;numPoints);                                 
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Prints the forces to file in ENSI GOLD format  
</pre>
<p class="item_name">INPUTS</p>
<pre>    force  (loaded_nodes*ndim)  - Mesh coordinates 
    sense  (loaded_nodes*ndim)  - Vector to define x,y,z 
    node   (loaded_nodes*ndim)  - Node Numbers of loaded nodes
    solidPatchIDSize            - Size of boundary Mesh     
    nn                          - # of Nodes                        
</pre>
<p class="item_name">OUTPUT</p>
<pre>      Writes to file "argv".ensi.NDLDS
      Contains information about loads on nodes
                    
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
    L. Margetts
</pre>

<hr />
<a name="parafemutils2fcheckparafem"></a>
<a name="robo10"></a><h2>parafemutils/checkparafem [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>checkparafem</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: checkparafem_(MeshData,g_num_OF,rest_ensi,       &amp;
                    &amp;numPoints,&amp;numCells);
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Writes the mesh to file in ensi gold format 
</pre>
<p class="item_name">INPUTS</p>
<pre>    g_coord   (ndim,nn)    - Mesh coordinates               
    g_num     (nod,nels)   - Steering Matrix (x-y-z)                                
    rest_ensi (nodof+1,nr) - Restrained Nodes
    nn                     - # of Nodes 
    els=nels               - # of Elements/Cells
                    
</pre>
<p class="item_name">OUTPUT</p>
<pre>    Writes to file "argv".ensi.case and oter. "argv".ensi.xxx files
    Contains information about Mesh, Material, Geometry and Restraints

    File    Description 

    MATID   Material ID's
    NDLDS   Loaded Nodes
    NDBND   Restrained Nodes 
    geo     Geometery File
    case    Case file
</pre>
<p class="item_name">WARNINGS</p>
<pre>    It currently only works in serial.
</pre>
<p class="item_name">TODO</p>
<pre>    * Clean and update
    * Write to work in parallel
                    
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2ffindnelspp"></a>
<a name="robo11"></a><h2>parafemutils/findnelspp [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>findnelspp</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Unused in current version
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function acts an access fuction for the
    Foam-Extend code, it returns the value of 
    nels_pp, the number of elements per processor 
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2ffindneqpp"></a>
<a name="robo12"></a><h2>parafemutils/findneqpp [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <a href="#robo19">setnelspp</a>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: const int neq_pp_OF = findneqpp_();
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function is used to return the neq_pp, the
    number of equations per processor to Foam-Extend
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fgloads"></a>
<a name="robo13"></a><h2>parafemutils/gloads [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>gloads</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: gloads_(gravlo_,&amp;specWeight,&amp;gPoints_,&amp;nodof,&amp;nod,&amp;ndim,
                   &amp;numRestrNodes_, mPoints_,g_num_pp_OF_,rest_);     
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Supplies a gravitational force vector   
</pre>
<p class="item_name">INPUTS</p>
<pre>    specWeight   - Specific Weight (density  * gravitaional loading)
    nn           - Total number of nodes in mesh
    nodof        - Number of degrees of freedom per node
    nod          - Number of Nodes per Element
    ndim         - Number of dimensions             
    nr           - Number of restrained nodes       

    g_num_pp (nod,nels_pp)  - Element Steering matrix
    g_coord  (ndim,nn)      - Global Coordinate matrix
    rest     (nr,nodof+1)   - Matrix of restrained nodes
</pre>
<p class="item_name">OUTPUT</p>
<pre>    gravlo_pp   (neq_pp)     - Vector of loads
            
</pre>
<p class="item_name">WARNINGS</p>
<pre>    * Default direction is negative Y
    * REST must be rearranged before function call  
</pre>
<p class="item_name">TODO</p>
<pre>    * Remove need for global coordinate matrix
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fof2sg"></a>
<a name="robo14"></a><h2>parafemutils/of2sg [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>of2sg</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage:      <strong>of2sg</strong>(element,g_num_pp(:,iel)) 
</pre>
<p class="item_name">FUNCTION</p>
<pre>    It rearranges the steering matrix from Foam-Extend format
    to Smith-Griffiths format
</pre>
<p class="item_name">INPUTS</p>
<pre>    element - Element Type  
    nod     - Number of nodes per element
</pre>
<p class="item_name">OUTPUT</p>
<pre>    vector  - New element node orders
</pre>
<p class="item_name">TODO</p>
<pre>    * Include tetrahedral elements
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fpopulate5fg5fcoord5fpp"></a>
<a name="robo15"></a><h2>parafemutils/populate_g_coord_pp [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>populate_g_coord_pp</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: CALL <strong>populate_g_coord_pp</strong>(g_coord,g_coord_pp,g_num_pp,    &amp;
                                         npes,nn,nod,ndim)
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Populates g_coord_pp based on g_coord. It takes the global
    list of coordinates and reduces them to the local coordinate 
    lists based on the steering matrix g_num_pp.
    It is used when the decomposition is done using ParaFEMs
    methods
</pre>
<p class="item_name">INPUTS</p>
<pre>    g_coord  (ndim,nn)  - Mesh coordinates  
    g_num_pp (nod,nels) - Steering Matrix   
    
    npes                - Number of processes
    nn                  - Number of nodes 
    nod                 - Number of nodes per element
    ndim                - Number of dimensions per node               
                    
</pre>
<p class="item_name">OUTPUT</p>
<pre>      g_coord_pp (nod,ndim,nels_pp) - Coordinate matrix
</pre>
<p class="item_name">WARNINGS</p>
<pre>    This version has been outdated by <a href="#robo16">populate_g_coord_pp2</a>.
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Sam Hewitt
</pre>
<p class="item_name">CREATION DATE</p>
<pre>    28th September 2016
</pre>
<p class="item_name">COPYRIGHT</p>
<pre>    (c) University of Manchester 2007-2016
</pre>

<hr />
<a name="parafemutils2fpopulate5fg5fcoord5fpp2"></a>
<a name="robo16"></a><h2>parafemutils/populate_g_coord_pp2 [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>populate_g_coord_pp2</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: CALL <strong>populate_g_coord_pp2</strong>(g_coord,g_coord_pp,g_num_pp,   &amp;
                                         nod,ndim)
</pre>
<p class="item_name">FUNCTION</p>
<pre>    Populates g_coord_pp based on g_coord. It takes the global
    list of coordinates and reduces them to the local coordinate 
    lists based on the steering matrix g_num_pp.
    It is used when decomposition has been done by Foam-Extend
</pre>
<p class="item_name">INPUTS</p>
<pre>    g_coord  (ndim,nn)  - Mesh coordinates          
    g_num_pp (nod,nels) - Steering Matrix           
    nn                  - Number of nodes 
    nod                 - Number of nodes per element
    ndim                - Number of dimensions per node             
</pre>
<p class="item_name">OUTPUT</p>
<pre>      g_coord_pp (nod,ndim,nels_pp) - Coordinate matrix
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Sam Hewitt
</pre>
<p class="item_name">CREATION DATE</p>
<pre>    6th May 2017
</pre>
<p class="item_name">COPYRIGHT</p>
<pre>    (c) University of Manchester 2007-2016
</pre>

<hr />
<a name="parafemutils2fpopulate5fg5fnum5fpp"></a>
<a name="robo17"></a><h2>parafemutils/populate_g_num_pp [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>populate_g_num_pp</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: CALL <strong>populate_g_num_pp</strong>(g_num,g_num_pp,npes,nod,nels)
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This subroutine was used in early versions of the code to
    distribute a global steering matrix to a local one
</pre>
<p class="item_name">INPUTS</p>
<pre>    g_num  (nod,nels)      - Global steering matrix         
    g_num_pp (nod,nels_pp) - Local Steering Matrix          
    npes                   - Number of Processors 
    nod                    - Number of nodes per element
    nels                   - Total Number elements  
</pre>
<p class="item_name">WARNINGS</p>
<pre>    This subroutine is currently not used it was relevant in
    a previous version.
</pre>
<p class="item_name">AUTHOR</p>
<pre>    Sam Hewitt
</pre>
<p class="item_name">CREATION DATE</p>
<pre>    28th September 2016
</pre>
<p class="item_name">COPYRIGHT</p>
<pre>    (c) University of Manchester 2007-2016
</pre>

<hr />
<a name="parafemutils2fsetielstart"></a>
<a name="robo18"></a><h2>parafemutils/setielstart [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>setielstart</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: CALL <strong>setielstart</strong>()
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function is used by initparafem to set
    the starting element number on each processor 
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fsetnelspp"></a>
<a name="robo19"></a><h2>parafemutils/setnelspp [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    <strong>setnelspp</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: setnelspp_(&amp;nels_pp_OF);
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function is used to set an input variable
    to the number of elements per processor, nels_pp
</pre>
<p class="item_name">INPUTS</p>
<pre>    nCells  - Number of Cells
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fsystem5fmem5fusage"></a>
<a name="robo20"></a><h2>parafemutils/system_mem_usage [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>system_mem_usage</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: CALL <strong>system_mem_usage</strong>(ValueA,ValueB)    
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function reads the /proc/procnum file of the
    current process and outputs the RSS and VM memory
    values, copying them into the inputs
</pre>
<p class="item_name">INPUTS</p>
<pre>    valueRSS   - RSS Memory (Resident Set Size)
    valueVM    - VM Memory  (Virtual Memory)        
</pre>
<p class="item_name">WARNINGS</p>
<pre>    If you are using a intel compiler, you must include 
    the ifport module
</pre>
<p class="item_name">NOTES</p>
<pre>    https://stackoverflow.com/questions/22028571/track-memory-usage-in-fortran-90
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fwriteToFile"></a>
<a name="robo21"></a><h2>parafemutils/writeToFile [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>writeToFile</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: CALL <strong>writeToFile</strong>(10,"g_num_pp.txt",g_num_pp,nod*nels_pp)    
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function writes a float field to file. Its main purpose
     is debugging and is not currrently called in the code.  
</pre>
<p class="item_name">INPUTS</p>
<pre>    filenum   - File Number, any positive Integer
    filename  - Name of output file
    field     - Field to loop through
    dim1      - Dimensions of the field
</pre>
<p class="item_name">OUTPUT</p>
<pre>    File of the name "filename" with the field written out          
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

<hr />
<a name="parafemutils2fwriteToFileInt"></a>
<a name="robo22"></a><h2>parafemutils/writeToFileInt [ Functions ]</h2>

<p>[ <a href="#robo_top_of_doc">Top</a> ] [ <a href="../robo_functions.html#robo_top_of_doc">Functions</a> ]</p>
<p class="item_name">NAME</p>
<pre>    SUBROUTINE: <strong>writeToFileInt</strong>
</pre>
<p class="item_name">SYNOPSIS</p>
<pre>    Usage: CALL <strong>writeToFileInt</strong>(10,"g_num_pp.txt",g_num_pp,nod*nels_pp)    
</pre>
<p class="item_name">FUNCTION</p>
<pre>    This function writes an Integer field to file. Its main purpose
     is debugging and is not currrently called in the code.  
</pre>
<p class="item_name">INPUTS</p>
<pre>    filenum   - File Number, any positive Integer
    filename  - Name of output file
    field     - Field to loop through
    dim1      - Dimensions of the field
</pre>
<p class="item_name">OUTPUT</p>
<pre>    File of the name "filename" with the field written out          
</pre>
<p class="item_name">AUTHOR</p>
<pre>    S. Hewitt
</pre>

</div> <!-- content -->
<div id="footer">
<p>Generated from ./../src/solidSolvers/paraFEM/fem_routines/parafemutils.f90 with <a href="http://www.xs4all.nl/~rfsber/Robo/robodoc.html">ROBODoc</a> V4.99.38 on Fri Aug 24 2018 18:11:19
</p>
</div> <!-- footer -->
</body>
</html>
